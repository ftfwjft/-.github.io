## 将学习转移到CCSD(T):从机器学习模型中精确的非谐波频率

#### ABSTRACT

在足够高的量子化学理论水平上，计算小到中等大小的分子的非调和模式，以将实验测量的频率分配到相应类型的分子运动是一项具有计算挑战性的工作。

在此，提出了一种实用且经济的方法，利用二阶振动摄动理论(VPT2)从机器学习模型计算耦合聚类质量的非谐频率。该方法被称为“NN +  VPT2”，使用高维神经网络(PhysNet)来学习不同理论水平的势能面(PESs)，从而可以有效地确定谐波和VPT2频率。将NN +  VPT2方法应用于8个小到中等大小的分子(H2CO、反式hono、HCOOH、CH3OH、CH3CHO、CH3NO2、C  H3COOH和CH3CONH2)，并在MP2/augcc-pVTZ、CCSD(T)/aug-cc-pVTZ和CCSD(T)- f12 /aug-cc-pVTZ-  f12理论水平上报告了NN学习模型的频率。对于最大的分子和在最高水平的理论，迁移学习(TL)被用来确定必要的全维，近平衡的PESs。

![image-20220215101322793](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215101322793.png)



#### INTRODUCTION

振动光谱是一种灵敏的探针，用于识别分子或跟踪气相和溶液中的构象和结构变化。振动光谱学在实际应用中的一个基本任务是将测量到的频率赋值给相应类型的分子运动。基于这些信息，也有可能预测这些运动特性的变化及其对频率本身的影响。在光谱密集的区域，如频率范围在1200到1700  cm−1之间，由于不同自由度之间的耦合，这些任务特别具有挑战性。

对分子振动动力学和红外光谱的准确描述一直是分子光谱学中一个极具挑战性的问题通常，这些计算需要精确的、全维度的势能面(PESs)，在这方面机器学习(ML)方法获得了很大的关注ML势被用来根据分子结构从广泛的从头计算数据生成能量和力的统计模型。所得到的电势可以以前所未有的精度再现参考数据

这项工作提出了一种实用的方法来计算小(4个原子)到中等(9个原子)分子从精确的、机器学习的电位的非谐波频率。ML-PESs被用作量子化学软件(这里是高斯包12)的外部能量函数

本工作报告了基于机器学习模型的系统研究H2CO、trans-HONO、HCOOH、CH3OH、CH3CHO、CH3NO2、C  H3COOH和ch3conh2的非谐频率，该模型使用了来自不同理论水平的电子结构计算的参考数据。然后，机器学习模型将用于谐波和VPT2计算，也可以与实验结果进行比较。在此基础上，进一步探讨了TL到更高层次的理论。



#### 计算方法

#####  Datasets： 取样与量子化学方法

生成MP2/  aug-cc-pVTZ、16、17 CCSD(T)/aug-cc-pVTZ、17−19和CCSD(T)-F12/aug-cc-pVTZ-  f1220、21(以下简称“MP2”、“CCSD(T)”和“CCSD(T)-F12”)三个理论层次的数据集。所有单点电子结构计算，包括ML所需的能量、力和偶极矩，以及谐波频率计算，都是使用molpro进行的。所有分子在MP2理论水平上产生了22个数据集;对于CCSD(T)，生成的是naom≤6的分子，对于naom≤5的分子，生成的是CCSD(T)-F12理论水平的数据集。

由于考虑了不同大小的分子，数据库的从头计算的数量是相应的比例。在这里，每个分子取样(3N−6)×  600个几何形状，并**添加优化的几何形状**。参考几何图形的生成是基于正常模态采样的首先，在MP2理论水平上对分子进行优化，并确定其法模矢量和相应的谐力常数。然后，通过沿模态矢量的线性组合随机置换原子，得到扭曲(非平衡)构象。这种采样是在不同的温度下进行的(这里，T  = 10、50、100、300、500、1000、1500和2000  K)。最初的数据集通过增加几何形状来扩大，因为PhysNet模型预测的正模频率比其他分子的误差更大。对于HONO来说，新增了2805个结构。使用半经验的GFN2-xTB方法，在1000  K下对NVT模拟的几何形状进行采样，并沿着特定的正态模式扩展结构。此外，由于VPT2计算中评估的结构(即，为了计算数值导数，原子稍微偏离了平衡几何)可以被提取，这些也被添加了(因此，“VPT2几何”)。对于CH3CHO，总共增加了1072个附加结构。这些对应于VPT2的几何形状和沿特定法线模的几何形状。对于CH3COOH，增加了109个VPT2几何形状。



##### 机器学习:PhysNet

PESs的表示是基于使用PhysNet架构的神经网络(NN)给出了对神经网络体系结构的详细描述，下面只给出了显著特征和当前工作中使用的特征。PhysNet是一种“信息传递”类型的高维神经网络，最近被应用于不同的分子系统。神经网络学习一个特征向量，该特征向量编码每个原子i的局部化学环境，用于预测总分子能量、原子力和分子偶极矩。

任意几何形状的分子的总能量包括长程静电和色散相互作用，由:

![image-20220215102249589](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215102249589.png)

其中，Ei为原子贡献，ED3为Grimme  's D3色散校正，qi为部分电荷，rij为原子间距离，ke为库仑常数，N为原子总数。注意，调整部分电荷以确保电荷守恒，并在短距离时对库仑项进行阻尼，以避免数值不稳定(详情见参考25)。除了能量外，PhysNet还根据![image-20220215102326998](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215102326998.png)预测了部分电荷的分子偶极矩，并利用逆模自动微分法得到了E对原子笛卡尔坐标的解析导数

在目前的工作中，PhysNet被用来预测偶极矩μ的解析导数和E的二阶导数，相对于笛卡尔坐标(即Hessians)。这是使用Tensorflow工具很容易实现的。将包含(3N−6)×  600 +  1数据点的数据集按照85%/10%/5%分割为训练/验证/测试集，用于拟合ML模型。训练集总是包含优化后的几何图形。PES表示是通过调整PhysNet参数来最好地描述参考能量，力和偶极子矩从显式量子化学计算获得的。使用AMSGrad进行优化不同误差项的相对贡献由加权超参数控制，相对于能量误差，力误差具有更高的权重/重要性。除了神经网络中相互作用的截止半径rcut(设为6 Å)外，所有神经网络结构及其优化方法的超参数均设为参考文献25所示的值。这样的截断足以包括所有分子中的所有相互作用。



##### 振动二阶微扰理论*

利用二阶振动摄动理论(VPT2)将非调和和模式耦合效应纳入光谱特性许多常见的量子化学软件包，如gaussian或CFOUR包含了直接从从头计算数据计算红外频率和强度的实现，包括非调和效应。VPT2假设系统的势能可以表示为四次力场，由

![image-20220215102503921](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215102503921.png)

其中，ωi是一个谐波频率，̂qi是(简化的无量纲)正态坐标，不要与部分电荷qi混淆，ϕijk和ϕijkl是位V对正态坐标的三阶和四阶导数。eq  2中的第一项对应于势能的谐波部分，而其余项描述了非谐波效应。利用前人的表达式，省略动力学/转动项，三次和四次力常数可得到非调和常数:

![image-20220215102853608](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215102853608.png)

由得到的非调和常数χ，根据x，得到了非调和基频νi:

![image-20220215102906273](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215102906273.png)

此外，还可以确定泛音、组合频带和零点能量.

在这项工作中，广义VPT213实现(GVPT2)在Gaussian套件中被用来确定非谐波频率。具体的设置包括使用哪个VPT2模型、数值微分的步长和共振阈值保持在其默认值。高斯的标准化接口由“外部”关键字初始化，用来调用外部脚本(例如，PhysNet势)，它为给定的分子/几何产生能量、梯度和Hessians。外部电位的输出通过高斯函数从一个标准文本文件中恢复，其中三次和四次项由数值导数确定并用于VPT2计算。



#### RESULTS

从三个方面评估ML模型的性能:

1. 能量(ΔE)和力(ΔF)的样本外误差用于单独测试集的几何形状。这些错误量化到何种程度的ML模型能够插值之间的训练点
2. 比较从训练的PhysNet模型确定的谐波频率和传统从头计算谐波频率在相同的理论水平。这些谐波频率也会影响非谐波(VPT2)频率
3. 在MP2水平上比较了PhysNet模型与高斯模型的VPT2频率，并与实验结果进行了比较。与从头算MP2 VPT2频率的比较量化了PhysNet  PES在最小值附近如何密切地再现从头算电位



##### 样本外的错误

所有的PhysNet模型在独立的测试集上通过平均绝对误差(MAEs)和均方根误差(RMSEs)对参考计算和PhysNet预测之间的能量和力进行评估(见图1和2)。在不同的理论水平上，MAEs(平方)和均方根误差(三角形)用颜色编码。对于理论的每个分子和层次，两个独立的PhysNet模型(不透明和透明符号)在相同的数据上训练，以评估一致性和重现性。最低的MAE(E)为0.0005  kcal/mol (H2CO)，而最大的MAE(E)为~ 0.0218 kcal/mol (CH3CONH2)，表明误差随系统大小而变化。

![image-20220215124836817](C:\Users\19684\AppData\Roaming\Typora\typora-user-images\image-20220215124836817.png)

与能量错误ΔE相似，力错误ΔF有随着系统大小增加而增加的趋势。与其他分子相比，H2CO的力误差明显较低。由于PhysNet是不变性的，相对于等效原子的排列，H2CO的C2v对称性可能是较低的样本外误差的原因。根据早期的研究，所有测试集的能量误差都比化学精度好得多



##### 谐波频率

从PhysNet表示计算的谐波频率是有用的，可以测试ML模型如何很好地再现接近最小PES的区域，与直接从从头计算确定的频率相比。此外，它们通过eq  6提供了非谐波频率，这对VPT2频率的计算至关重要。图3通过各自的能量函数优化每个分子的结构，比较了MOLPRO22和PhysNet的参考从头算谐波频率。

![image-20220215124951281](C:\Users\19684\AppData\Roaming\Typora\typora-user-images\image-20220215124951281.png)

##### VPT2频率

评估VPT2频率的质量为最佳(基于MAE()  PhysNet模型)。为此，利用MP2数据训练的PhysNet模型计算出VPT2频率，并将其与初始值相比较(见图4)。这种比较没有用于更高层次的理论，因为(i)高斯分布下的VPT2方法只适用于具有解析二阶导数的能级12，(ii)对于较大的分子，计算会非常昂贵。MP2  VPT2的大部分频率可复制到大于5 cm−1的范围内，单个较大的差异可达10 cm−1。

![image-20220215125026160](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215125026160.png)

耦合集群质量的PhysNet模型达到了类似的精度。在CCSD(T)和CCSD(T)-F12水平的谐波频率结果进一步支持了这一点。(非调和的)PhysNet  VPT2频率也可以直接与实验数据进行比较(见图5)。对于小分子，可以发现很好的一致性，从MP2到CCSD(T)-F12，频率向实验值收敛。在CCSD(T)-F12数据上训练的H2CO的PhysNet模型的VPT2频率重现实验数据41，最大偏差约为20  cm−1,MAE(MAE)值约为4 cm−1。在其他CCSD(T)-F12模型中也可以看到类似的趋势，其中HONO (HCOOH)的MAE(ν)约为7  cm−1(∼4 cm−1)(见表1)。从MP2到CCSD(T)-F12, MAE值减少了约5倍。

![image-20220215125103106](C:\Users\19684\AppData\Roaming\Typora\typora-user-images\image-20220215125103106.png)





##### 将学习转移到耦合聚类质量

由于基于mp2的模型的准确性是有限的，并且由于它在计算上过于昂贵，以获得全面的耦合聚类质量训练数据集的大分子，因此必须考虑替代方法。在基于神经网络的方法中，TL可用于开发不同理论水平的数据之间的相关性TL时使用获得的知识学习如何解决一个任务作为起点,学习如何解决相关,但不同的任务相似之处与潜在变形技术,

在这里，TL被用来获得基于MP2水平训练的模型的大分子的耦合聚类质量的PESs。为此,MP2模型作为一个很好的初始估计,只有一小部分的数据集,计算在CCSD  (T)层面,必须提供TL。transfer-learn模型,训练MP2  PhysNet模型的参数数据是用来初始化PhysNet培训。然后，利用更高层次理论中的能量、力和偶极矩来训练PhysNet(即，参数被调整)。与从头开始训练模型时相同的方法和使用相同的超参数进行训练，只是学习速率下降到10−5−10−4的范围内。

图6显示了迁移学习的PhysNet模型、在CCSD(T)-F12数据上训练的PhysNet模型和在MP2数据上训练的模型(TL的“基础模型”)相对于实验H2CO频率的偏差。除一个高频模态外，nntl2的VPT2频率与NNCCSD(T)−F12的VPT2频率非常接近，与实验相比，自始至终明显优于NNMP2的VPT2频率。TL用于获得只有MP2参考数据的所有模型(即CH3CHO、CH3NO2、C  H3COOH和CH3CONH2)的高质量PESs。对于每一个分子，原始的、较低水平的数据集的5%或更少在CCSD(T)水平上重新计算。TL数据集包含使用普通模式方法(在不同温度之间均匀分割)采样的几何图形、VPT2几何图形和MP2优化的几何图形。

![image-20220215132618007](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215132618007.png)

根据85%/10%/  5%的细分，数据集再次被随机分割为TL的训练/验证/测试集。因此，TL模型仅在少数分子几何上进行测试。对于较大的分子，评估TL模型的性能是比较困难的。一方面，TL集合中相当少的几何图形主要用于训练和验证。因此，只有一小部分(<50个几何图形)仍然用于测试模型，可能会给出统计上没有意义的结果。对所有分子的单独测试集的评估产生MAEs(E)  valu s of  <0.03千卡/mol和MAE(f)值<0.02千卡/mol/Å(与图1和2相比)，并且在预期的范围内。为完整起见，所有TL模型的能量和力的MAEs和均方根误差列于支持资料的表S28中。第二个衡量性能的指标是谐波频率，它可以与直接从头计算得到的频率进行比较。尽管CCSD(T)水平上的优化和正常模式计算在计算大分子时变得相当昂贵，但对所有大分子CH3CHO、CH3NO2、CH3COOH和CH3CONH2都进行了优化和正常模式计算。这些误差也在从零开始训练的模型所达到的误差范围内。CH3CONH2的误差略大(MAE(ω) = 1.1  cm−1;参见支持信息表S32)。最后，可以通过比较VPT2的频率来评估学习到CCSD(T)的模型的性能

![image-20220215132729118](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215132729118.png)

对于较大的分子，评估TL模型的性能是比较困难的。一方面，TL集合中相当少的几何图形主要用于训练和验证。因此，只有一小部分(<50个几何图形)仍然用于测试模型，可能会给出统计上没有意义的结果。对所有分子的单独测试集的评估产生MAEs(E)  valu s of <0.03千卡/mol和MAE(f)值<0.02千卡/mol/Å(与图1和2相比)，并且在预期的范围内。

第二个衡量性能的指标是谐波频率，它可以与直接从头计算得到的频率进行比较。尽管CCSD(T)水平上的优化和正常模式计算在计算大分子时变得相当昂贵，但对所有大分子CH3CHO、CH3NO2、CH3COOH和CH3CONH2都进行了优化和正常模式计算。

![image-20220215132824795](https://gitee.com/ftfwjft/images/raw/master/image/cloud/image-20220215132824795.png)

最后，可以通过比较VPT2的频率来评估学习到CCSD(T)的模型的性能.作为参考，根据MP2数据训练的PhysNet模型的VPT2频率与TL模型一起报告。很明显,TL模型更接近实验,尤其是高频模式,CH3CHO、CH3NO2和CH3COOH具有良好的一致性，而CH3CONH2的情况则不太清楚。



##### Timings

通过使用从头开始计算(见表S1从头开始能源的成本,力量,和偶极矩计算)和潜在的PES  PhysNet表示,可以确定VPT2频率相当高水平的理论连续分子比是可能的从从头开始评估。这就提出了一个问题:如何比较不同方法的计算效率?

我们考虑了以下几点:在给定的从头开始水平上的可行性，PhysNet的数据生成和学习，以及NN  + VPT2和从头开始之间的交叉。

###### 在给定的从头开始水平上的可行性

VPT2计算在MP2水平上已经被考虑到所有分子。CPU计算时间从几小时的小分子(H2CO: 2.5 h, HONO: 5小时),,多个CPU小时HCOOH /  CH3OH (14 h)和乙醛浓度(60 h),在数天的最大分子(190 h为醋酸,后为CH3NO2 103 h,谷氨酸和298  h)。然而,与实验相比,VPT2频率MP2水平的理论被发现不如CCSD (T)与无符号偏差高达150厘米−1(见表1),一个完整的CCSD (T)  VPT2治疗可能最小的分子,这将是更大的结构过于昂贵。据报道，在不同的理论水平上计算H2CO的VPT2比计算谐波频率要贵10倍。在目前的工作中也发现了这一点。尽管对于大分子，这个因子会增加(因为必须评估更多的衍生物)，但它可以用来初步评估大分子CCSD(T)  VPT2治疗的成本。计算CH3CONH2在CCSD(T)水平的谐波频率需要超过20个CPU天，这意味着CCSD(T) VPT2的计算需要超过200个CPU天。

###### PhysNet的数据生成和学习

生成一个PhysNet模型的时间包括数据集的计算(能量、力和偶极矩的从头计算)、训练和验证NN。成本最高的步骤是培训(≤5天)，以及根据理论水平计算参考数据。

例如，生成最昂贵的数据集(CCSD(T)-F12级别的5401个HCOOH几何图形:每次计算约130个CPU分钟)需要约2天，假设可以并行执行250个计算(计算的“实时”可能更长，这取决于输入/输出(I/O)性能)。

计算PhysNet  VPT2是最便宜的步骤，需要<1小时(H2CO 18分钟，CH3CONH2  58分钟)。作为一个明确的例子，MP2级的数据生成，神经网络训练，以及对CH3COOH或CH3CONH2的VPT2计算被考虑。保守的估计生成参考数据,PhysNet模型的拟合和测试7天,直接从头开始VPT2  MP2级别的计算理论的成本超过了NN +  VPT2方法这两个分子的1.1倍(10%)和1.7(70%)

对于更大的分子，这个因子进一步增加，就像对更高层次的方法一样。此外，本文所研究的方法还具有全维度、近平衡PES的额外好处，这种PES也可以用于MD模拟，尽管可能需要一些额外的参考计算。

###### 在NN + VPT2和从头开始之间的交叉

我们感兴趣的是，就总体计算成本而言，NN  +  VPT2方法在什么时候比从头开始的方法更有优势。对于更高层次的理论，从头计算VPT2的成本比单计算(能量、力和偶极矩)要低，因为要重复计算势能的一阶到四阶导数。如果从头计算VPT2的成本估计为54为10  × tharm(其中tharm是计算谐波频率的时间)，

然后，在CCSD(T)水平(tharm = 30 h)，  PhysNet模型已经对HCOOH更加有利。计算包括能源、力量和偶极矩要求∼9 CPU小时平均,而实时生成接近15 h)在< 2天,TL可以执行成本的1  h。一起的时间参考数据生成MP2,训练,和评估的基本神经网络,在CCSD(T)级别上，CH3CONH2的VPT2频率的总估计时间大约是10个CPU天，而通过暴力计算估计为200个CPU天。

从经验上看，这接近于线性缩放，而在从头开始的水平上，缩放从MP2的N5正式增加到CCSD(T)的N7。55总之，虽然在MP2水平上，NN  + VPT2方法仅对两个最大的分子具有计算上的优势，但它在更高水平上优于从头计算方法，除了四原子分子。当使用TL时，NN +  VPT2方法对于大分子和更高水平的可行性得到加强。



#### DISCUSSION

结果提出了到目前为止已经证实毫升模型收益率相同的正常模式和VPT2频率直接从电子结构计算和评估计算和实验之间的比较是有利的(无符号之间的偏差<  0.5厘米−1和21厘米−1在CCSD (T) f12模型和<  0.5厘米−1和88之间cm−1为CCSD(T)模型，包括TL)。

另外，计算出的正常模态频率常常由经验因素决定，以便直接与实验进行比较表1总结了实验测量频率之间的mae,  VPT2计算在三个理论水平上的mae，以及MP2和CCSD(T)计算中的比例谐波频率(最后一列)。缩放的MP2和CCSD(T)频率与实验测量的频率平均相差20−50  cm−1。这与PhysNet-PES上MP2级(非调和)VPT2计算和实验之间的差异相当。另一方面，CCSD(T)和CCSD(T)-F12  PESs的VPT2计算结果更加一致(平均MAE为10和5 cm−1)，明显优于MP2计算结果(缩放谐波和VPT2)和缩放谐波CCSD(T)频率。

VPT2方法的一个已知的局限性是它适用于具有大构象变化的柔性分子。

TL的应用表明，相对于参考值，TL模型的谐波频率达到MAE(ω)，与从零开始训练的模型相当。从较低级别PES获得高质量PES所需的少量额外成本，以及获得从头开始谐波频率所需成本的迅速扩大，促使使用TL来确定其高质量谐波频率,全维从头计算PESs在计算上过于昂贵。

将精确的(非谐波的)VPT2频率与实验进行比较可以提供更多的信息。这种比较取决于计算的质量和实验的质量。一种特别吸引人的可能性是比较和潜在地重新分配各个模式。

最近的理论工作通过对全局CCSD(T)(F12*)/cc-pVTZ-F12  PES的振动构型相互作用(VCI)计算确定了顺式和转换酸的频率，并试图重新分配实验确定的基频、泛音和组合频带。

对于更大分子的NN +  VPT2方法的应用，重要的是要注意，在计算时间方面，限制因素不是VPT2计算本身，而是生成合适数据集的努力和训练NN的时间。事实上，利用PhysNet势的VPT2计算几乎与原子数N线性缩放

尽管VPT2计算没有限制，但还是有兴趣简单地考虑一下减少其计算负担的方法。当基于ml的小肽系统的PESs变得可用时，这将是特别有趣的。其中之一是降维(RD)方法常情况下，一旦有了合适的NN模型，VPT2分析目前就可以在很少的额外成本下进行，这使得RD-或hybridVPT2几乎是冗余的，除非是最大的系统。



#### CONCLUSION AND OUTLOOK

结合NN +  VPT2方法，与TL，被证明提供精确的非谐波频率在高水平的电子结构理论。利用PhysNet代码，进一步预测了偶极矩μ和E的二阶导数对笛卡尔坐标(即Hessians)的解析导数。由于许多高级电子结构方法都没有明确地实现解析二阶导数，因此目前的基于神经网络的方法在精度和计算效率方面都具有优势。目前的方法可以通过使用更高层次的理论数据，明确地或使用TL来系统地改进，并允许人们在从头计算VPT2是不切实际的理论水平上获得VPT2频率。

目前的研究可以扩展到包括红外强度的基本原理，组合波段，和泛音。此外，该方法可以扩展到研究大分子，并协助(重新)分配实验红外光谱。研究还表明，对于最小分子和考虑的最低理论水平(MP2/aug-cc-pVTZ)，直接计算谐波和VPT2频率比NN  + VPT2组合方法计算效率更高。然而，对于有6个或更多原子的分子以及更高水平的量子化学处理(CCSD(T)或更高)，NN +  VPT2方法在计算上要高效得多。最后，VPT2在这些最高理论水平上的频率与实验确定的频率相比(在几cm−1以内)较为理想。高级VPT2计算的另一个应用是精确测定二聚能，例如氢键配合物，为此需要精确的非调和零点振动能此外，将TL中参考ML模型的DFT计算应用到更高的理论水平，是进一步提高现有方法效率的一个有吸引力的前景。最后，可以通过使用复杂的抽样或学习方法(如主动学习)来实现额外的改进。
